<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Немного индивидуальности не повредит</title>

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/hyde.css">
  <link rel="stylesheet" href="/css/poole-overrides.css">
  <link rel="stylesheet" href="/css/hyde-overrides.css">
  <link rel="stylesheet" href="/css/hyde-x.css">
  <link rel="stylesheet" href="/css/highlight/github.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/custom.css">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/touch-icon-144-precomposed.png">
  <link href="/favicon.png" rel="icon">

  
  
  <link href="http://feeds.feedburner.com/not-a-kernel-guy" rel="alternate" type="application/rss+xml" title="Алексей Пахунов" />

  <meta name="description" content="Блог про космос, программирование и всякое разное.">
  <meta name="keywords" content="">
  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-1329392-1', 'auto');
    ga('send', 'pageview');
  </script>
  
</head>
<body>
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      
      <h1>Алексей Пахунов</h1>
      <p class="lead">&hellip; также известный как &ldquo;Not a kernel guy&rdquo;</p>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="/">Блог</a></li>
      
      <li class="sidebar-nav-item"><a href="/post/">Архив</a></li>
      
      <li class="sidebar-nav-item"><a href="/about">Об авторе</a></li>
      
      <li class="sidebar-nav-item"><a href="http://feeds.feedburner.com/not-a-kernel-guy">Подписаться на RSS канал</a></li>
      
      <li class="sidebar-nav-item"><a href="https://follow.it/fucjll?action=followPub">Почтовая рассылка</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      <script>
        (function() {
          var cx = '009966018894572705542:ewu98_itf-q';
          var gcse = document.createElement('script');
          gcse.type = 'text/javascript';
          gcse.async = true;
          gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
              '//cse.google.com/cse/cse.js?cx=' + cx;
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(gcse, s);
        })();
      </script>
      <gcse:searchbox-only></gcse:searchbox-only>
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      
      
      
      <a href="https://www.linkedin.com/in/alexpakhunov"><i class="fa fa-linkedin-square fa-3x"></i></a>
      
      
      
      
      
      <a href="http://feeds.feedburner.com/not-a-kernel-guy" type="application/rss+xml"><i class="fa fa-rss-square fa-3x"></i></a>
      </li>
    </ul>

    

    <p>Copyright &copy; 2006 - 2023 <a href="/license/">License</a><br/>
       Powered by <a href="http://gohugo.io">Hugo</a> and <a href="https://github.com/zyro/hyde-x">Hyde-X</a></p>

  </div>
</div>


<div class="content container">
  <div class="post">
    <h1 class="post-title">Немного индивидуальности не повредит</h1>
    <span class="post-date">Jun 7, 2007 &middot; <a href="https://blog.not-a-kernel-guy.com/2007/06/07/195/#disqus_thread">Comments</a>
    
    <br/>
    <a class="label" href="/tags/%D1%82%D0%B5%D1%85%D0%BD%D0%BE%D0%BB%D0%BE%D0%B3%D0%B8%D0%B8">Технологии</a><a class="label" href="/tags/troubleshooting">Troubleshooting</a>
    </span>
    <p>Сегодня с утра возился с решением забавной проблемы. Началось всё с того, что вчера Katy, наш администратор, обрадовала меня, сообщив что пришли заказанные диски и <a href="http://www.byteccusa.com/product/enclosure/ME-747.htm">FireWire контейнеры</a> для них. К концу дня радость немного поугасла, так как выяснилось, что оба диска одновременно работать отказываются. Т.е. любой из них по отдельности работал как часы, а вот при подключении второго ничего не происходило. Диск не появлялся. :-(</p>
<p>Немного поискав в интернете, я наконец нашел вот <a href="http://forums.macosxhints.com/archive/index.php/t-60621.html">эту страничку</a>, которая рассказывала о аналогичной проблеме. Рецепт оказался прост:</p>
<hr>
<p>Two big clues were (1) a posting on the Coolmax forum, and (2) the following entry from one of the readme&rsquo;s for Prolific firmware.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-no-highlight" data-lang="no-highlight">02/24/2003 - 
1. Fix the problem of &#39;Unique ID with 1394 Serial No.&#39; 
For two or more same PL-3507 IDE device on the same 1394 bus, the EUID64 should be unique. 
The 1394 Serial No. is now used in the EEPROM to construct the unique EUID64 bytes (64bits = 8 bytes). 
bytes #0 ~2 : Company ID (00 50 77 for Prolific) 
bytes #3 : Device Type (HD/CD-ROM/DVD/MO...) 
bytes #4~7 : 1394 Serial No. (modified by PL3507 EEPROM Writor) 

Note: Must use PL-3507 EEPROM Writer V 0.0.0.6. 
</code></pre></div><p>Of course this &ldquo;EEPROM Writer&rdquo; was nowhere to be found. But in the process of doing a firmware update, I noted that the updater utility had an option to save the current firmware to a &ldquo;.bin&rdquo; file. To make a long story short, what I eventually figured out is that this .bin file included everything, INCLUDING THE SECTION WITH THE &ldquo;1394 Serial No.&rdquo; above. I further determined that this Serial No. was IDENTICAL on all my enclosures. The manufacturer had NOT serialized the chips. (This is like buying several ethernet boards, all with the same mac address assigned - a no-no.)</p>
<p>On a hunch, I used a hex editor and modified the serial number in the .bin file, and reflashed the firmware. Low and behold now my system &lsquo;saw&rsquo; that enclosure at the same time as one of the unmodified enclosures!</p>
<p>My hunch was confirmed - the top portion of the flash is used to hold data, including this serial number. The normal firmware updates do not disturb this portion, but if you update with the previously saved .bin file, it allows you to overwrite the entire flash, including this data.</p>
<p>So for people with improperly serialized PL-3507 based enclosures, there is a way to &lsquo;fix&rsquo; this, if you are sufficiently brave and willing to manually patch your firmware image.</p>
<p>Get the firmware updater. The current version is at
<a href="http://www.prolific.com.tw/support/files//IDE%20Storage/PL-3507/Firmware/fw_pl3507B_d042006.zip">http://www.prolific.com.tw/support/files//IDE%20Storage/PL-3507/Firmware/fw_pl3507B_d042006.zip</a>
The zip includes both the most recent firmware and the updater utility. Please note the following from Prolific web-site:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-no-highlight" data-lang="no-highlight">fw_pl3507B_d042006.zip 2006/5/19 108 KB 
</code></pre></div><p>PL-3507B Firmware Update
F/W Version: 2006.04.20.149 [Checksum 4D6F]
For Chip B and above versions only (w/ ICP Support)
Warning: This firmware is intended ONLY for Prolific customers and not for end-users. If you are an end-user and still want to use this, use at your own risk. Use ICP v2.0.4 and firmware 09/22/2004 first if your current firmware is older than 04/10/2003.</p>
<ol>
<li>Update your flash to the current version using this.</li>
<li>Use the updater to save a copy of your flash to a .bin file.</li>
<li>Using a hex editor on the .bin, look after offset 0x7400 for the above signature - 00 50 77</li>
<li>The next byte is the device type, the next four bytes are the serial number.</li>
<li>Patch the serial number (increment one of the bytes)</li>
<li>Save the modified .bin</li>
<li>Use the firmware updater to reflash, using the .bin file</li>
</ol>
<p>Do this for each of your enclosures, giving each a unique serial number.</p>
<hr>
<p>Каждое из устройств, подключенных по FireWire должно иметь уникальный идентификатор. В данном случае речь шла некоем “1394 Serial No.”. Этот номер хранится в прошивке ATAPI-to-FireWire контроллера.</p>
<p>Дальнейшее было бы делом техники, если бы не одна маленькая деталь – утилита для записи прошивки напрочь отказывалась работать с одном из контейнеров, однако без проблем работала с другим. В результате я нашел и опробовал штук пять разных вариантов этой утилиты. Ни один не заработал со «счастливым контейнером». С другим работали последние три версии.</p>
<p>Здраво рассудив, что чтобы серийные номера были разными, достаточно поменять лишь один из них, я решил попробовать. Перекрестившись, закачал текущую версию прошивки, нашел в ней серийный номер по трем байтам производителя (00 50 77 для Prolific) и поменял 1394 Serial No.</p>
<p><img src="/2007/06/prolific_id.png" alt=""></p>
<p>Попутно выяснилось, что заветная последовательность “00 50 77” встречается в прошивке два раза. Решив, что менять сразу два бита будет через чур, залил прошивку с одним исправленным номером. Выключил, включил назад – ура, ура! - список устройств пополнился двумя “SBP2 Compliant IEEE 1394 device”. Впрочем один из дисков по прежнему не был виден. :-( Перезагрузился, показались оба диска.</p>
<p><img src="/2007/06/prolific.png" alt=""></p>
<p>Наконец-то!</p>
  </div>
  <div id="disqus_thread"></div>
</div>


<script type="text/javascript">
var disqus_shortname = "alexeypa";
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>



<script type="text/javascript">
    var disqus_config = function () {
        this.page.url = "https://blog.not-a-kernel-guy.com/2007/06/07/195/";
        this.page.title = "Немного индивидуальности не повредит";
    };
    var disqus_shortname = "alexeypa";
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>

